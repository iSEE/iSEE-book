<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Dynamic differential expression | Extending iSEE</title>
  <meta name="description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Dynamic differential expression | Extending iSEE" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Dynamic differential expression | Extending iSEE" />
  
  <meta name="twitter:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

<meta name="author" content="Kevin Rue-Albrecht, Federico Marini, Charlotte Soneson, and Aaron Lun" />


<meta name="date" content="2020-10-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon_package_v0.16/favicon.ico" type="image/x-icon" />
<link rel="prev" href="dynamic-reduced-dimensions.html"/>
<link rel="next" href="annotated-gene-list.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Extending <i>iSEE</i></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I API overview</b></span></li>
<li class="chapter" data-level="1" data-path="panels.html"><a href="panels.html"><i class="fa fa-check"></i><b>1</b> Panel classes</a><ul>
<li class="chapter" data-level="1.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="panels.html"><a href="panels.html#virtual-classes"><i class="fa fa-check"></i><b>1.2</b> Virtual classes</a></li>
<li class="chapter" data-level="1.3" data-path="panels.html"><a href="panels.html#concrete-classes"><i class="fa fa-check"></i><b>1.3</b> Concrete classes</a></li>
<li class="chapter" data-level="1.4" data-path="panels.html"><a href="panels.html#extending-the-classes"><i class="fa fa-check"></i><b>1.4</b> Extending the classes</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="api.html"><a href="api.html"><i class="fa fa-check"></i><b>2</b> Panel generics</a><ul>
<li class="chapter" data-level="2.1" data-path="api.html"><a href="api.html#overview-1"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="api.html"><a href="api.html#class-basics"><i class="fa fa-check"></i><b>2.2</b> Class basics</a></li>
<li class="chapter" data-level="2.3" data-path="api.html"><a href="api.html#parameter-set-up"><i class="fa fa-check"></i><b>2.3</b> Parameter set-up</a></li>
<li class="chapter" data-level="2.4" data-path="api.html"><a href="api.html#defining-the-user-interface"><i class="fa fa-check"></i><b>2.4</b> Defining the user interface</a><ul>
<li class="chapter" data-level="2.4.1" data-path="api.html"><a href="api.html#in-general"><i class="fa fa-check"></i><b>2.4.1</b> In general</a></li>
<li class="chapter" data-level="2.4.2" data-path="api.html"><a href="api.html#the-dotplot-visual-interface"><i class="fa fa-check"></i><b>2.4.2</b> The <code>DotPlot</code> visual interface</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="api.html"><a href="api.html#creating-observers"><i class="fa fa-check"></i><b>2.5</b> Creating observers</a></li>
<li class="chapter" data-level="2.6" data-path="api.html"><a href="api.html#defining-panel-outputs"><i class="fa fa-check"></i><b>2.6</b> Defining panel outputs</a><ul>
<li class="chapter" data-level="2.6.1" data-path="api.html"><a href="api.html#in-general-1"><i class="fa fa-check"></i><b>2.6.1</b> In general</a></li>
<li class="chapter" data-level="2.6.2" data-path="api.html"><a href="api.html#for-dotplots"><i class="fa fa-check"></i><b>2.6.2</b> For <code>DotPlot</code>s</a></li>
<li class="chapter" data-level="2.6.3" data-path="api.html"><a href="api.html#for-tables"><i class="fa fa-check"></i><b>2.6.3</b> For <code>Table</code>s</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="api.html"><a href="api.html#handling-selections"><i class="fa fa-check"></i><b>2.7</b> Handling selections</a><ul>
<li class="chapter" data-level="2.7.1" data-path="api.html"><a href="api.html#multiple"><i class="fa fa-check"></i><b>2.7.1</b> Multiple</a></li>
<li class="chapter" data-level="2.7.2" data-path="api.html"><a href="api.html#single"><i class="fa fa-check"></i><b>2.7.2</b> Single</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="api.html"><a href="api.html#miscellaneous"><i class="fa fa-check"></i><b>2.8</b> Miscellaneous</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="server.html"><a href="server.html"><i class="fa fa-check"></i><b>3</b> Application state</a><ul>
<li class="chapter" data-level="3.1" data-path="server.html"><a href="server.html#overview-2"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="server.html"><a href="server.html#updating-parameters"><i class="fa fa-check"></i><b>3.2</b> Updating parameters</a></li>
<li class="chapter" data-level="3.3" data-path="server.html"><a href="server.html#reading-the-memory"><i class="fa fa-check"></i><b>3.3</b> Reading the memory</a></li>
<li class="chapter" data-level="3.4" data-path="server.html"><a href="server.html#reacting-to-events"><i class="fa fa-check"></i><b>3.4</b> Reacting to events</a></li>
<li class="chapter" data-level="3.5" data-path="server.html"><a href="server.html#guidelines-for-user-globals"><i class="fa fa-check"></i><b>3.5</b> Guidelines for user globals</a></li>
</ul></li>
<li class="part"><span><b>II Worked examples</b></span></li>
<li class="chapter" data-level="4" data-path="developing.html"><a href="developing.html"><i class="fa fa-check"></i><b>4</b> Reduced dimension hexbin plot</a><ul>
<li class="chapter" data-level="4.1" data-path="developing.html"><a href="developing.html#overview-3"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="developing.html"><a href="developing.html#class-basics-1"><i class="fa fa-check"></i><b>4.2</b> Class basics</a></li>
<li class="chapter" data-level="4.3" data-path="developing.html"><a href="developing.html#setting-up-the-interface"><i class="fa fa-check"></i><b>4.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="4.4" data-path="developing.html"><a href="developing.html#creating-the-observers"><i class="fa fa-check"></i><b>4.4</b> Creating the observers</a></li>
<li class="chapter" data-level="4.5" data-path="developing.html"><a href="developing.html#generating-the-plot"><i class="fa fa-check"></i><b>4.5</b> Generating the plot</a></li>
<li class="chapter" data-level="4.6" data-path="developing.html"><a href="developing.html#in-action"><i class="fa fa-check"></i><b>4.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html"><i class="fa fa-check"></i><b>5</b> Dynamic reduced dimensions</a><ul>
<li class="chapter" data-level="5.1" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#overview-4"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#class-basics-2"><i class="fa fa-check"></i><b>5.2</b> Class basics</a></li>
<li class="chapter" data-level="5.3" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#setting-up-the-interface-1"><i class="fa fa-check"></i><b>5.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="5.4" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#creating-the-observers-1"><i class="fa fa-check"></i><b>5.4</b> Creating the observers</a></li>
<li class="chapter" data-level="5.5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#making-the-plot"><i class="fa fa-check"></i><b>5.5</b> Making the plot</a></li>
<li class="chapter" data-level="5.6" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#in-action-1"><i class="fa fa-check"></i><b>5.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html"><i class="fa fa-check"></i><b>6</b> Dynamic differential expression</a><ul>
<li class="chapter" data-level="6.1" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#overview-5"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#class-basics-3"><i class="fa fa-check"></i><b>6.2</b> Class basics</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#setting-up-the-interface-2"><i class="fa fa-check"></i><b>6.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="6.4" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#creating-the-observers-2"><i class="fa fa-check"></i><b>6.4</b> Creating the observers</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#making-the-table"><i class="fa fa-check"></i><b>6.5</b> Making the table</a></li>
<li class="chapter" data-level="6.6" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#in-action-2"><i class="fa fa-check"></i><b>6.6</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html"><i class="fa fa-check"></i><b>7</b> Annotated gene list</a><ul>
<li class="chapter" data-level="7.1" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#overview-6"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#class-basics-4"><i class="fa fa-check"></i><b>7.2</b> Class basics</a></li>
<li class="chapter" data-level="7.3" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#setting-up-the-interface-3"><i class="fa fa-check"></i><b>7.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="7.4" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#creating-the-observers-3"><i class="fa fa-check"></i><b>7.4</b> Creating the observers</a></li>
<li class="chapter" data-level="7.5" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#in-action-3"><i class="fa fa-check"></i><b>7.5</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html"><i class="fa fa-check"></i><b>8</b> Gene ontology table</a><ul>
<li class="chapter" data-level="8.1" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#overview-7"><i class="fa fa-check"></i><b>8.1</b> Overview</a></li>
<li class="chapter" data-level="8.2" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#class-basics-5"><i class="fa fa-check"></i><b>8.2</b> Class basics</a></li>
<li class="chapter" data-level="8.3" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#setting-up-the-interface-4"><i class="fa fa-check"></i><b>8.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="8.4" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#generating-the-output"><i class="fa fa-check"></i><b>8.4</b> Generating the output</a></li>
<li class="chapter" data-level="8.5" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#creating-the-observers-4"><i class="fa fa-check"></i><b>8.5</b> Creating the observers</a></li>
<li class="chapter" data-level="8.6" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#handling-selections-1"><i class="fa fa-check"></i><b>8.6</b> Handling selections</a></li>
<li class="chapter" data-level="8.7" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#in-action-4"><i class="fa fa-check"></i><b>8.7</b> In action</a></li>
</ul></li>
<li class="part"><span><b>III Appendix</b></span></li>
<li class="chapter" data-level="9" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i><b>9</b> Contributors</a><ul>
<li><a href="contributors.html#aaron-lun"><em>Aaron Lun</em></a></li>
<li><a href="contributors.html#kevin-rue-albrecht"><em>Kevin Rue-Albrecht</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extending <em>iSEE</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dynamic-differential-expression" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Dynamic differential expression</h1>
<div id="overview-5" class="section level2">
<h2><span class="header-section-number">6.1</span> Overview</h2>
<p>In this case study, we will create a panel class to dynamically compute differential expression (DE) statistics between the active sample-level selection and the other saved selections from a transmitting panel.
We will present the results of this computation in a <code>DataTable</code> widget from the <em><a href="https://CRAN.R-project.org/package=DT">DT</a></em> package, where each row is a gene and each column is a relevant statistic (<span class="math inline">\(p\)</span>-value, FDR, log-fold changes, etc.).
The class proposed here is the basis of the <code>DifferentialStatsticsTable</code> from <em><a href="https://bioconductor.org/packages/3.11/iSEEu">iSEEu</a></em>.</p>
</div>
<div id="class-basics-3" class="section level2">
<h2><span class="header-section-number">6.2</span> Class basics</h2>
<p>First, we define the basics of our new <code>Panel</code> class.
As our new class will be showing each gene as a row, we inherit from the <code>RowTable</code> virtual class.
This automatically gives us access to all the functionality promised in the contract,
including interface elements and observers to respond to multiple selections.
We also add a slot specifying the log-fold change threshold to use in the null hypothesis.</p>
<p>Any new slots should come with validity methods, as shown below.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="dynamic-differential-expression.html#cb23-1"></a><span class="kw">library</span>(S4Vectors)</span>
<span id="cb23-2"><a href="dynamic-differential-expression.html#cb23-2"></a><span class="kw">setValidity2</span>(<span class="st">&quot;DGETable&quot;</span>, <span class="cf">function</span>(object) {</span>
<span id="cb23-3"><a href="dynamic-differential-expression.html#cb23-3"></a>    msg &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="dv">0</span>)</span>
<span id="cb23-4"><a href="dynamic-differential-expression.html#cb23-4"></a></span>
<span id="cb23-5"><a href="dynamic-differential-expression.html#cb23-5"></a>    <span class="cf">if</span> (<span class="kw">length</span>(val &lt;-<span class="st"> </span>object[[<span class="st">&quot;LogFC&quot;</span>]])<span class="op">!=</span>1L <span class="op">||</span><span class="st"> </span>val <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb23-6"><a href="dynamic-differential-expression.html#cb23-6"></a>        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;NGenes&#39; must be a non-negative number&quot;</span>)</span>
<span id="cb23-7"><a href="dynamic-differential-expression.html#cb23-7"></a>    }</span>
<span id="cb23-8"><a href="dynamic-differential-expression.html#cb23-8"></a>    <span class="cf">if</span> (<span class="kw">length</span>(msg)) {</span>
<span id="cb23-9"><a href="dynamic-differential-expression.html#cb23-9"></a>        <span class="kw">return</span>(msg)</span>
<span id="cb23-10"><a href="dynamic-differential-expression.html#cb23-10"></a>    }</span>
<span id="cb23-11"><a href="dynamic-differential-expression.html#cb23-11"></a>    <span class="ot">TRUE</span></span>
<span id="cb23-12"><a href="dynamic-differential-expression.html#cb23-12"></a>})</span></code></pre></div>
<p>It is also worthwhile specializing the <code>initialize()</code> method to provide a default for new parameters.
We hard-code the <code>ColumnSelectionType</code> setting as we want to obtain all multiple selections from the transmitting panel,
in order to be able to perform pairwise DE analyses between the various active and saved selections.
(By comparison, the default of <code>"Active"</code> will only transmit the current active selection.)
We also define a constructor to conveniently create new instances.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="dynamic-differential-expression.html#cb24-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;initialize&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, </span>
<span id="cb24-2"><a href="dynamic-differential-expression.html#cb24-2"></a>    <span class="cf">function</span>(.Object, <span class="dt">LogFC=</span><span class="dv">0</span>, ...) </span>
<span id="cb24-3"><a href="dynamic-differential-expression.html#cb24-3"></a>{</span>
<span id="cb24-4"><a href="dynamic-differential-expression.html#cb24-4"></a>    <span class="kw">callNextMethod</span>(.Object, <span class="dt">LogFC=</span>LogFC, <span class="dt">ColumnSelectionType=</span><span class="st">&quot;Union&quot;</span>, ...)</span>
<span id="cb24-5"><a href="dynamic-differential-expression.html#cb24-5"></a>})</span>
<span id="cb24-6"><a href="dynamic-differential-expression.html#cb24-6"></a></span>
<span id="cb24-7"><a href="dynamic-differential-expression.html#cb24-7"></a>DGETable &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</span>
<span id="cb24-8"><a href="dynamic-differential-expression.html#cb24-8"></a>    <span class="kw">new</span>(<span class="st">&quot;DGETable&quot;</span>, ...)</span>
<span id="cb24-9"><a href="dynamic-differential-expression.html#cb24-9"></a>}</span></code></pre></div>
</div>
<div id="setting-up-the-interface-2" class="section level2">
<h2><span class="header-section-number">6.3</span> Setting up the interface</h2>
<p>The most basic requirement is to define some methods that describe our new panel in the <code>iSEE()</code> interface.
This includes defining the full name and desired default color for display purposes:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="dynamic-differential-expression.html#cb25-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.fullName&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;Differential expression table&quot;</span>)</span>
<span id="cb25-2"><a href="dynamic-differential-expression.html#cb25-2"></a></span>
<span id="cb25-3"><a href="dynamic-differential-expression.html#cb25-3"></a><span class="kw">setMethod</span>(<span class="st">&quot;.panelColor&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;#55AA00&quot;</span>)</span></code></pre></div>
<p>We also add interface elements to change the result type and the number of genes.
This is most easily done by specializing the <code>.defineDataInterface()</code> generic.
We <code>paste0</code> the name of our panel to the name of any parameter to ensure that the ID is unique to this instance of our panel.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="dynamic-differential-expression.html#cb26-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb26-2"><a href="dynamic-differential-expression.html#cb26-2"></a><span class="kw">setMethod</span>(<span class="st">&quot;.defineDataInterface&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, <span class="cf">function</span>(x, se, select_info) {</span>
<span id="cb26-3"><a href="dynamic-differential-expression.html#cb26-3"></a>    plot_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb26-4"><a href="dynamic-differential-expression.html#cb26-4"></a>    <span class="kw">list</span>(</span>
<span id="cb26-5"><a href="dynamic-differential-expression.html#cb26-5"></a>        <span class="kw">numericInput</span>(<span class="kw">paste0</span>(plot_name, <span class="st">&quot;_LogFC&quot;</span>), <span class="dt">label=</span><span class="st">&quot;Log-FC threshold&quot;</span>,</span>
<span id="cb26-6"><a href="dynamic-differential-expression.html#cb26-6"></a>            <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">value=</span>x[[<span class="st">&quot;LogFC&quot;</span>]])</span>
<span id="cb26-7"><a href="dynamic-differential-expression.html#cb26-7"></a>    )</span>
<span id="cb26-8"><a href="dynamic-differential-expression.html#cb26-8"></a>})</span></code></pre></div>
<p>By default, all <code>RowTable</code>s hide their multiple column selection parameter choices.
This considers the typical use case where <code>RowTable</code>s respond to a selection of rows rather than a selection of columns.
For <code>DGETable</code>s, we need to flip this around by specializing <code>.hideInterface()</code> so that the unresponsive row selection parameters are hidden in the interface while the useful column selection parameters are visible.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="dynamic-differential-expression.html#cb27-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.hideInterface&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, <span class="cf">function</span>(x, field) {</span>
<span id="cb27-2"><a href="dynamic-differential-expression.html#cb27-2"></a>    <span class="cf">if</span> (field <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RowSelectionSource&quot;</span>, <span class="st">&quot;RowSelectionType&quot;</span>, </span>
<span id="cb27-3"><a href="dynamic-differential-expression.html#cb27-3"></a>        <span class="st">&quot;RowSelectionSaved&quot;</span>, <span class="st">&quot;RowSelectionDynamicSource&quot;</span>)) {</span>
<span id="cb27-4"><a href="dynamic-differential-expression.html#cb27-4"></a>        <span class="ot">TRUE</span></span>
<span id="cb27-5"><a href="dynamic-differential-expression.html#cb27-5"></a>    } <span class="cf">else</span> <span class="cf">if</span> (field <span class="op">%in%</span><span class="st"> &quot;ColumnSelectionSource&quot;</span>) {</span>
<span id="cb27-6"><a href="dynamic-differential-expression.html#cb27-6"></a>        <span class="ot">FALSE</span></span>
<span id="cb27-7"><a href="dynamic-differential-expression.html#cb27-7"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-8"><a href="dynamic-differential-expression.html#cb27-8"></a>        <span class="kw">callNextMethod</span>()</span>
<span id="cb27-9"><a href="dynamic-differential-expression.html#cb27-9"></a>    }</span>
<span id="cb27-10"><a href="dynamic-differential-expression.html#cb27-10"></a>})</span></code></pre></div>
<p>A more advanced version of this panel class might consider responding to a row selection by only performing the DE analysis on the selected features.
In such cases, we would not need to hide <code>RowSelectionSource</code>, though we will leave that as an exercise for the curious.</p>
</div>
<div id="creating-the-observers-2" class="section level2">
<h2><span class="header-section-number">6.4</span> Creating the observers</h2>
<p>We specialize <code>.createObservers</code> to define some observers to respond to changes in our new interface elements.
Note the use of <code>callNextMethod()</code> to ensure that observers of the parent class are also created;
this automatically ensures that we can respond to changes in parameters provided by <code>RowTable</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="dynamic-differential-expression.html#cb28-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.createObservers&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, </span>
<span id="cb28-2"><a href="dynamic-differential-expression.html#cb28-2"></a>    <span class="cf">function</span>(x, se, input, session, pObjects, rObjects) </span>
<span id="cb28-3"><a href="dynamic-differential-expression.html#cb28-3"></a>{</span>
<span id="cb28-4"><a href="dynamic-differential-expression.html#cb28-4"></a>    <span class="kw">callNextMethod</span>()</span>
<span id="cb28-5"><a href="dynamic-differential-expression.html#cb28-5"></a></span>
<span id="cb28-6"><a href="dynamic-differential-expression.html#cb28-6"></a>    plot_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)</span>
<span id="cb28-7"><a href="dynamic-differential-expression.html#cb28-7"></a></span>
<span id="cb28-8"><a href="dynamic-differential-expression.html#cb28-8"></a>    <span class="kw">.createUnprotectedParameterObservers</span>(plot_name,</span>
<span id="cb28-9"><a href="dynamic-differential-expression.html#cb28-9"></a>        <span class="dt">fields=</span><span class="st">&quot;LogFC&quot;</span>,</span>
<span id="cb28-10"><a href="dynamic-differential-expression.html#cb28-10"></a>        <span class="dt">input=</span>input, <span class="dt">pObjects=</span>pObjects, <span class="dt">rObjects=</span>rObjects)</span>
<span id="cb28-11"><a href="dynamic-differential-expression.html#cb28-11"></a>})</span></code></pre></div>
<p>The distinction between protected and unprotected parameters is less important for <code>Table</code>s;
as long as the types of the columns do not change between renderings, any column or global selections (i.e., search terms) are usually still sensible.</p>
</div>
<div id="making-the-table" class="section level2">
<h2><span class="header-section-number">6.5</span> Making the table</h2>
<p>When working with a <code>RowTable</code> subclass, the easiest way to change plotting content to override the <code>.generateTable</code> method.
This is expected to generate a <code>data.frame</code> in the evaluation environment, returning the commands required to do so.
In this case, we want to perform one-sided <span class="math inline">\(t\)</span>-tests between the active selection and any number of saved selections.
We will use the <code>findMarkers()</code> function from <em><a href="https://bioconductor.org/packages/3.11/scran">scran</a></em> to compute the desired statistics.
This performs all pairwise comparisons, so is not as efficient as could be, but it will suffice for this demonstration.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="dynamic-differential-expression.html#cb29-1"></a><span class="kw">setMethod</span>(<span class="st">&quot;.generateTable&quot;</span>, <span class="st">&quot;DGETable&quot;</span>, <span class="cf">function</span>(x, envir) {</span>
<span id="cb29-2"><a href="dynamic-differential-expression.html#cb29-2"></a>    empty &lt;-<span class="st"> &quot;tab &lt;- data.frame(Top=integer(0), p.value=numeric(0), FDR=numeric(0));&quot;</span></span>
<span id="cb29-3"><a href="dynamic-differential-expression.html#cb29-3"></a></span>
<span id="cb29-4"><a href="dynamic-differential-expression.html#cb29-4"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;col_selected&quot;</span>, envir, <span class="dt">inherits=</span><span class="ot">FALSE</span>) <span class="op">||</span><span class="st"> </span></span>
<span id="cb29-5"><a href="dynamic-differential-expression.html#cb29-5"></a><span class="st">        </span><span class="kw">length</span>(envir<span class="op">$</span>col_selected)<span class="op">&lt;</span>2L <span class="op">||</span><span class="st"> </span></span>
<span id="cb29-6"><a href="dynamic-differential-expression.html#cb29-6"></a><span class="st">        </span><span class="op">!</span><span class="st">&quot;active&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(envir<span class="op">$</span>col_selected)) </span>
<span id="cb29-7"><a href="dynamic-differential-expression.html#cb29-7"></a>    {</span>
<span id="cb29-8"><a href="dynamic-differential-expression.html#cb29-8"></a>        commands &lt;-<span class="st"> </span>empty</span>
<span id="cb29-9"><a href="dynamic-differential-expression.html#cb29-9"></a>    } <span class="cf">else</span> {</span>
<span id="cb29-10"><a href="dynamic-differential-expression.html#cb29-10"></a>        commands &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;.chosen &lt;- unlist(col_selected);&quot;</span>,</span>
<span id="cb29-11"><a href="dynamic-differential-expression.html#cb29-11"></a>            <span class="st">&quot;.grouping &lt;- rep(names(col_selected), lengths(col_selected));&quot;</span>,</span>
<span id="cb29-12"><a href="dynamic-differential-expression.html#cb29-12"></a>            <span class="kw">sprintf</span>(<span class="st">&quot;.de.stats &lt;- scran::findMarkers(logcounts(se)[,.chosen], </span></span>
<span id="cb29-13"><a href="dynamic-differential-expression.html#cb29-13"></a><span class="st">    .grouping, direction=&#39;up&#39;, lfc=%s)&quot;</span>, x[[<span class="st">&quot;LogFC&quot;</span>]]),</span>
<span id="cb29-14"><a href="dynamic-differential-expression.html#cb29-14"></a>            <span class="st">&quot;tab &lt;- as.data.frame(.de.stats[[&#39;active&#39;]]);&quot;</span></span>
<span id="cb29-15"><a href="dynamic-differential-expression.html#cb29-15"></a>        )</span>
<span id="cb29-16"><a href="dynamic-differential-expression.html#cb29-16"></a>    }</span>
<span id="cb29-17"><a href="dynamic-differential-expression.html#cb29-17"></a>       </span>
<span id="cb29-18"><a href="dynamic-differential-expression.html#cb29-18"></a>    <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text=</span>commands), <span class="dt">envir=</span>envir)</span>
<span id="cb29-19"><a href="dynamic-differential-expression.html#cb29-19"></a></span>
<span id="cb29-20"><a href="dynamic-differential-expression.html#cb29-20"></a>    <span class="kw">list</span>(<span class="dt">commands=</span>commands, <span class="dt">contents=</span>envir<span class="op">$</span>tab)</span>
<span id="cb29-21"><a href="dynamic-differential-expression.html#cb29-21"></a>})</span></code></pre></div>
<p>Readers may notice that we prefix internal variables with <code>.</code> in our commands.
This ensures that they do not clash with global variables created by <code>iSEE()</code> itself
(which is not an issue when running the app, but makes things difficult when the code is reported for tracking purposes).</p>
</div>
<div id="in-action-2" class="section level2">
<h2><span class="header-section-number">6.6</span> In action</h2>
<p>Let’s put our new panel to the test.
We’ll use the <code>sce</code> object from Chapter <a href="developing.html#developing">4</a>, which includes some precomputed dimensionality reduction results.
The plan is to create a (fixed) reduced dimension plot that will transmit to our DGE table.
We set up an iSEE instance with an existing brush on the former to trigger computation of differential results by the latter.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="dynamic-differential-expression.html#cb30-1"></a><span class="co"># Setting up multiple active and saved brushes.</span></span>
<span id="cb30-2"><a href="dynamic-differential-expression.html#cb30-2"></a>rdp &lt;-<span class="st"> </span><span class="kw">ReducedDimensionPlot</span>(<span class="dt">PanelId=</span>1L,</span>
<span id="cb30-3"><a href="dynamic-differential-expression.html#cb30-3"></a>    <span class="dt">BrushData =</span> <span class="kw">list</span>(</span>
<span id="cb30-4"><a href="dynamic-differential-expression.html#cb30-4"></a>        <span class="dt">xmin =</span> <span class="dv">17</span>, <span class="dt">xmax =</span> <span class="dv">55</span>, <span class="dt">ymin =</span> <span class="dv">-36</span>, <span class="dt">ymax =</span> <span class="dv">29</span>, </span>
<span id="cb30-5"><a href="dynamic-differential-expression.html#cb30-5"></a>        <span class="dt">coords_css =</span> <span class="kw">list</span>(<span class="dt">xmin =</span> 300L, <span class="dt">xmax =</span> 450L, <span class="dt">ymin =</span> 170L, <span class="dt">ymax =</span> 404L), </span>
<span id="cb30-6"><a href="dynamic-differential-expression.html#cb30-6"></a>        <span class="dt">coords_img =</span> <span class="kw">list</span>( <span class="dt">xmin =</span> 375L, <span class="dt">xmax =</span> <span class="dv">562</span>, <span class="dt">ymin =</span> <span class="dv">212</span>, <span class="dt">ymax =</span> 505L), </span>
<span id="cb30-7"><a href="dynamic-differential-expression.html#cb30-7"></a>        <span class="dt">img_css_ratio =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">1</span>), </span>
<span id="cb30-8"><a href="dynamic-differential-expression.html#cb30-8"></a>        <span class="dt">mapping =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="st">&quot;X&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>), </span>
<span id="cb30-9"><a href="dynamic-differential-expression.html#cb30-9"></a>        <span class="dt">domain =</span> <span class="kw">list</span>(<span class="dt">left =</span> <span class="dv">-49</span>, <span class="dt">right =</span> <span class="dv">57</span>, <span class="dt">bottom =</span> <span class="dv">-53</span>, <span class="dt">top =</span> <span class="dv">70</span>), </span>
<span id="cb30-10"><a href="dynamic-differential-expression.html#cb30-10"></a>        <span class="dt">range =</span> <span class="kw">list</span>(<span class="dt">left =</span> <span class="dv">49</span>, <span class="dt">right =</span> <span class="dv">570</span>, <span class="dt">bottom =</span> <span class="dv">580</span>, <span class="dt">top =</span> <span class="dv">31</span>), </span>
<span id="cb30-11"><a href="dynamic-differential-expression.html#cb30-11"></a>        <span class="dt">log =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>), </span>
<span id="cb30-12"><a href="dynamic-differential-expression.html#cb30-12"></a>        <span class="dt">direction =</span> <span class="st">&quot;xy&quot;</span>, <span class="dt">brushId =</span> <span class="st">&quot;ReducedDimensionPlot1_Brush&quot;</span>, </span>
<span id="cb30-13"><a href="dynamic-differential-expression.html#cb30-13"></a>        <span class="dt">outputId =</span> <span class="st">&quot;ReducedDimensionPlot1&quot;</span></span>
<span id="cb30-14"><a href="dynamic-differential-expression.html#cb30-14"></a>    ),</span>
<span id="cb30-15"><a href="dynamic-differential-expression.html#cb30-15"></a>    <span class="dt">SelectionHistory =</span> <span class="kw">list</span>(</span>
<span id="cb30-16"><a href="dynamic-differential-expression.html#cb30-16"></a>        <span class="kw">list</span>(</span>
<span id="cb30-17"><a href="dynamic-differential-expression.html#cb30-17"></a>            <span class="dt">xmin =</span> <span class="dv">-44</span>, <span class="dt">xmax =</span> <span class="dv">-1</span>, <span class="dt">ymin =</span> <span class="dv">5</span>, <span class="dt">ymax =</span> <span class="dv">59</span>, </span>
<span id="cb30-18"><a href="dynamic-differential-expression.html#cb30-18"></a>            <span class="dt">coords_css =</span> <span class="kw">list</span>(<span class="dt">xmin =</span> 57L, <span class="dt">xmax =</span> 225L, <span class="dt">ymin =</span> 64L, <span class="dt">ymax =</span> 254L), </span>
<span id="cb30-19"><a href="dynamic-differential-expression.html#cb30-19"></a>            <span class="dt">coords_img =</span> <span class="kw">list</span>(<span class="dt">xmin =</span> <span class="dv">71</span>, <span class="dt">xmax =</span> <span class="dv">281</span>, <span class="dt">ymin =</span> 80L, <span class="dt">ymax =</span> <span class="dv">317</span>), </span>
<span id="cb30-20"><a href="dynamic-differential-expression.html#cb30-20"></a>            <span class="dt">img_css_ratio =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">1</span>), </span>
<span id="cb30-21"><a href="dynamic-differential-expression.html#cb30-21"></a>            <span class="dt">mapping =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="st">&quot;X&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>), </span>
<span id="cb30-22"><a href="dynamic-differential-expression.html#cb30-22"></a>            <span class="dt">domain =</span> <span class="kw">list</span>(<span class="dt">left =</span> <span class="dv">-49</span>, <span class="dt">right =</span> <span class="dv">57</span>, <span class="dt">bottom =</span> <span class="dv">-53</span>, <span class="dt">top =</span> <span class="dv">70</span>), </span>
<span id="cb30-23"><a href="dynamic-differential-expression.html#cb30-23"></a>            <span class="dt">range =</span> <span class="kw">list</span>(<span class="dt">left =</span> <span class="dv">49</span>, <span class="dt">right =</span> <span class="dv">570</span>, <span class="dt">bottom =</span> <span class="dv">580</span>, <span class="dt">top =</span> <span class="dv">31</span>), </span>
<span id="cb30-24"><a href="dynamic-differential-expression.html#cb30-24"></a>            <span class="dt">log =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>), </span>
<span id="cb30-25"><a href="dynamic-differential-expression.html#cb30-25"></a>            <span class="dt">direction =</span> <span class="st">&quot;xy&quot;</span>, <span class="dt">brushId =</span> <span class="st">&quot;ReducedDimensionPlot1_Brush&quot;</span>, </span>
<span id="cb30-26"><a href="dynamic-differential-expression.html#cb30-26"></a>            <span class="dt">outputId =</span> <span class="st">&quot;ReducedDimensionPlot1&quot;</span></span>
<span id="cb30-27"><a href="dynamic-differential-expression.html#cb30-27"></a>        )</span>
<span id="cb30-28"><a href="dynamic-differential-expression.html#cb30-28"></a>    )</span>
<span id="cb30-29"><a href="dynamic-differential-expression.html#cb30-29"></a>) </span>
<span id="cb30-30"><a href="dynamic-differential-expression.html#cb30-30"></a></span>
<span id="cb30-31"><a href="dynamic-differential-expression.html#cb30-31"></a>dget &lt;-<span class="st"> </span><span class="kw">DGETable</span>(<span class="dt">ColumnSelectionSource=</span><span class="st">&quot;ReducedDimensionPlot1&quot;</span>, </span>
<span id="cb30-32"><a href="dynamic-differential-expression.html#cb30-32"></a>    <span class="dt">PanelWidth=</span>8L, <span class="dt">DataBoxOpen=</span><span class="ot">TRUE</span>)</span>
<span id="cb30-33"><a href="dynamic-differential-expression.html#cb30-33"></a>app &lt;-<span class="st"> </span><span class="kw">iSEE</span>(sce, <span class="dt">initial=</span><span class="kw">list</span>(rdp, dget))</span></code></pre></div>
<p><img src="screenshots/de-table.png" width="100%" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dynamic-reduced-dimensions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="annotated-gene-list.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["iSEE-book.pdf", "iSEE-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
