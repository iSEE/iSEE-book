<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Gene ontology table | Extending iSEE</title>
  <meta name="description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Gene ontology table | Extending iSEE" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Gene ontology table | Extending iSEE" />
  
  <meta name="twitter:description" content="This book describes how to use the Bioconductor iSEE package to create web-applications for exploring data stored in SummarizedExperiment objects." />
  

<meta name="author" content="Kevin Rue-Albrecht, Federico Marini, Charlotte Soneson, and Aaron Lun" />


<meta name="date" content="2020-03-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="annotated-gene-list.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Extending <i>iSEE</i></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="panels.html"><a href="panels.html"><i class="fa fa-check"></i><b>1</b> Panel classes</a><ul>
<li class="chapter" data-level="1.1" data-path="panels.html"><a href="panels.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="panels.html"><a href="panels.html#the-panel-class"><i class="fa fa-check"></i><b>1.2</b> The Panel class</a></li>
<li class="chapter" data-level="1.3" data-path="panels.html"><a href="panels.html#the-dotplot-and-table-panel-families"><i class="fa fa-check"></i><b>1.3</b> The DotPlot and Table panel families</a></li>
<li class="chapter" data-level="1.4" data-path="panels.html"><a href="panels.html#the-columndotplot-and-rowdotplot-panel-families"><i class="fa fa-check"></i><b>1.4</b> The ColumnDotPlot and RowDotPlot panel families</a></li>
<li class="chapter" data-level="1.5" data-path="panels.html"><a href="panels.html#built-in-columndotplot-panel-classes"><i class="fa fa-check"></i><b>1.5</b> Built-in ColumnDotPlot panel classes</a></li>
<li class="chapter" data-level="1.6" data-path="panels.html"><a href="panels.html#built-in-rowdotplot-panel-classes"><i class="fa fa-check"></i><b>1.6</b> Built-in RowDotPlot panel classes</a></li>
<li class="chapter" data-level="1.7" data-path="panels.html"><a href="panels.html#the-columntable-and-rowtable-panel-families"><i class="fa fa-check"></i><b>1.7</b> The ColumnTable and RowTable panel families</a></li>
<li class="chapter" data-level="1.8" data-path="panels.html"><a href="panels.html#built-in-columntable-panel-classes"><i class="fa fa-check"></i><b>1.8</b> Built-in ColumnTable panel classes</a></li>
<li class="chapter" data-level="1.9" data-path="panels.html"><a href="panels.html#built-in-rowtable-panel-classes"><i class="fa fa-check"></i><b>1.9</b> Built-in RowTable panel classes</a></li>
<li class="chapter" data-level="1.10" data-path="panels.html"><a href="panels.html#complexheatmapplot-class"><i class="fa fa-check"></i><b>1.10</b> The ComplexHeatmapPlot panel class</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="api.html"><a href="api.html"><i class="fa fa-check"></i><b>2</b> The panel API</a><ul>
<li class="chapter" data-level="2.1" data-path="api.html"><a href="api.html#cachecommoninfo"><i class="fa fa-check"></i><b>2.1</b> .cacheCommonInfo</a></li>
<li class="chapter" data-level="2.2" data-path="api.html"><a href="api.html#refineparameters"><i class="fa fa-check"></i><b>2.2</b> .refineParameters</a></li>
<li class="chapter" data-level="2.3" data-path="api.html"><a href="api.html#generatedotplot"><i class="fa fa-check"></i><b>2.3</b> .generateDotPlot</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="server.html"><a href="server.html"><i class="fa fa-check"></i><b>3</b> The app server</a><ul>
<li class="chapter" data-level="3.1" data-path="server.html"><a href="server.html#robjects"><i class="fa fa-check"></i><b>3.1</b> Reactive objects</a></li>
<li class="chapter" data-level="3.2" data-path="server.html"><a href="server.html#persistent-non-reactive-objects"><i class="fa fa-check"></i><b>3.2</b> Persistent (non-reactive) objects</a></li>
<li class="chapter" data-level="3.3" data-path="server.html"><a href="server.html#memory"><i class="fa fa-check"></i><b>3.3</b> The app memory</a></li>
<li class="chapter" data-level="3.4" data-path="server.html"><a href="server.html#initialization-of-the-app-server"><i class="fa fa-check"></i><b>3.4</b> Initialization of the app server</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="developing.html"><a href="developing.html"><i class="fa fa-check"></i><b>4</b> Developing new panels</a><ul>
<li class="chapter" data-level="4.1" data-path="developing.html"><a href="developing.html#create-a-new-s4-class"><i class="fa fa-check"></i><b>4.1</b> Create a new S4 class</a></li>
<li class="chapter" data-level="4.2" data-path="developing.html"><a href="developing.html#add-a-constructor-function"><i class="fa fa-check"></i><b>4.2</b> Add a constructor function</a></li>
<li class="chapter" data-level="4.3" data-path="developing.html"><a href="developing.html#set-the-panel-name-in-the-gui"><i class="fa fa-check"></i><b>4.3</b> Set the panel name in the GUI</a></li>
<li class="chapter" data-level="4.4" data-path="developing.html"><a href="developing.html#define-the-commands-generating-a-plot-output"><i class="fa fa-check"></i><b>4.4</b> Define the commands generating a plot output</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html"><i class="fa fa-check"></i><b>5</b> Dynamic reduced dimensions</a><ul>
<li class="chapter" data-level="5.1" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#overview-1"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#class-basics"><i class="fa fa-check"></i><b>5.2</b> Class basics</a></li>
<li class="chapter" data-level="5.3" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#setting-up-the-interface"><i class="fa fa-check"></i><b>5.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="5.4" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#creating-the-observers"><i class="fa fa-check"></i><b>5.4</b> Creating the observers</a></li>
<li class="chapter" data-level="5.5" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#making-the-plot"><i class="fa fa-check"></i><b>5.5</b> Making the plot</a></li>
<li class="chapter" data-level="5.6" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#finishing-touches"><i class="fa fa-check"></i><b>5.6</b> Finishing touches</a></li>
<li class="chapter" data-level="5.7" data-path="dynamic-reduced-dimensions.html"><a href="dynamic-reduced-dimensions.html#in-action"><i class="fa fa-check"></i><b>5.7</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html"><i class="fa fa-check"></i><b>6</b> Dynamic differential expression</a><ul>
<li class="chapter" data-level="6.1" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#overview-2"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#class-basics-1"><i class="fa fa-check"></i><b>6.2</b> Class basics</a></li>
<li class="chapter" data-level="6.3" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#setting-up-the-interface-1"><i class="fa fa-check"></i><b>6.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="6.4" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#creating-the-observers-1"><i class="fa fa-check"></i><b>6.4</b> Creating the observers</a></li>
<li class="chapter" data-level="6.5" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#making-the-table"><i class="fa fa-check"></i><b>6.5</b> Making the table</a></li>
<li class="chapter" data-level="6.6" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#finishing-touches-1"><i class="fa fa-check"></i><b>6.6</b> Finishing touches</a></li>
<li class="chapter" data-level="6.7" data-path="dynamic-differential-expression.html"><a href="dynamic-differential-expression.html#in-action-1"><i class="fa fa-check"></i><b>6.7</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html"><i class="fa fa-check"></i><b>7</b> Annotated gene list</a><ul>
<li class="chapter" data-level="7.1" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#overview-3"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#class-basics-2"><i class="fa fa-check"></i><b>7.2</b> Class basics</a></li>
<li class="chapter" data-level="7.3" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#setting-up-the-interface-2"><i class="fa fa-check"></i><b>7.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="7.4" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#creating-the-observers-2"><i class="fa fa-check"></i><b>7.4</b> Creating the observers</a></li>
<li class="chapter" data-level="7.5" data-path="annotated-gene-list.html"><a href="annotated-gene-list.html#in-action-2"><i class="fa fa-check"></i><b>7.5</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html"><i class="fa fa-check"></i><b>8</b> Gene ontology table</a><ul>
<li class="chapter" data-level="8.1" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#overview-4"><i class="fa fa-check"></i><b>8.1</b> Overview</a></li>
<li class="chapter" data-level="8.2" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#class-basics-3"><i class="fa fa-check"></i><b>8.2</b> Class basics</a></li>
<li class="chapter" data-level="8.3" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#setting-up-the-interface-3"><i class="fa fa-check"></i><b>8.3</b> Setting up the interface</a></li>
<li class="chapter" data-level="8.4" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#generating-the-output"><i class="fa fa-check"></i><b>8.4</b> Generating the output</a></li>
<li class="chapter" data-level="8.5" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#creating-the-observers-3"><i class="fa fa-check"></i><b>8.5</b> Creating the observers</a></li>
<li class="chapter" data-level="8.6" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#handling-selections"><i class="fa fa-check"></i><b>8.6</b> Handling selections</a></li>
<li class="chapter" data-level="8.7" data-path="gene-ontology-table.html"><a href="gene-ontology-table.html#in-action-3"><i class="fa fa-check"></i><b>8.7</b> In action</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Extending <em>iSEE</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gene-ontology-table" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Gene ontology table</h1>
<div id="overview-4" class="section level2">
<h2><span class="header-section-number">8.1</span> Overview</h2>
<p>Here, we will construct a table of GO terms where selection of a row in the table causes transmission of a multiple selection of gene names. The aim is to enable us to transmit multiple row selections to other panels based on their membership of a gene set. This is a fairly involved example of creating a <code>Panel</code> subclass as we cannot easily inherit from an existing subclass; rather, we need to provide all the methods ourselves.</p>
</div>
<div id="class-basics-3" class="section level2">
<h2><span class="header-section-number">8.2</span> Class basics</h2>
<p>First, we define the basics of our new <code>GOTable</code> class. This inherits from the virtual base <code>Panel</code> class as it cannot meet any of the contractual requirements of the subclasses, what with the <code>DataTable</code> selection event triggering a multiple selection rather than a single selection. We add some slots to specify the feature ID type and the organism of interest as well as for <code>DataTable</code> parameters.</p>
<p>We also add some checks for these parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">allowable &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ENSEMBL&quot;</span>, <span class="st">&quot;SYMBOL&quot;</span>, <span class="st">&quot;ENTREZID&quot;</span>)
<span class="kw">setValidity2</span>(<span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(object) {
    msg &lt;-<span class="st"> </span><span class="kw">character</span>(<span class="dv">0</span>)

    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(orgdb &lt;-<span class="st"> </span>object[[<span class="st">&quot;Organism&quot;</span>]])) {
        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="kw">sprintf</span>(<span class="st">&quot;&#39;Organism&#39; should be a single string&quot;</span>, orgdb))
    }

    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(type &lt;-<span class="st"> </span>object[[<span class="st">&quot;IDType&quot;</span>]]) <span class="op">||</span><span class="st"> </span><span class="op">!</span>type <span class="op">%in%</span><span class="st"> </span>allowable) {
        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;IDType&#39; should be &#39;ENSEMBL&#39;, &#39;SYMBOL&#39; or &#39;ENTREZID&#39;&quot;</span>)
    }

    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(object[[<span class="st">&quot;Selected&quot;</span>]])) { 
        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;Selected&#39; should be a single string&quot;</span>)
    }

    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isSingleString</span>(object[[<span class="st">&quot;Search&quot;</span>]])) {
        msg &lt;-<span class="st"> </span><span class="kw">c</span>(msg, <span class="st">&quot;&#39;Search&#39; should be a single string&quot;</span>)
    }

    <span class="cf">if</span> (<span class="kw">length</span>(msg)) {
        <span class="kw">return</span>(msg)
    }
    <span class="ot">TRUE</span>
})</code></pre></div>
<p>We then specialize the initialize method to set reasonable defaults.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;initialize&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(.Object, 
    <span class="dt">Organism=</span><span class="st">&quot;org.Mm.eg.db&quot;</span>, <span class="dt">IDType=</span><span class="st">&quot;SYMBOL&quot;</span>, 
    <span class="dt">Selected=</span><span class="st">&quot;&quot;</span>, <span class="dt">Search=</span><span class="st">&quot;&quot;</span>, <span class="dt">SearchColumns=</span><span class="kw">character</span>(<span class="dv">0</span>), ...)
{
    <span class="kw">callNextMethod</span>(.Object, <span class="dt">IDType=</span>IDType, <span class="dt">Organism=</span>Organism, 
        <span class="dt">Selected=</span>Selected, <span class="dt">Search=</span>Search, 
        <span class="dt">SearchColumns=</span>SearchColumns, ...)
})</code></pre></div>
</div>
<div id="setting-up-the-interface-3" class="section level2">
<h2><span class="header-section-number">8.3</span> Setting up the interface</h2>
<p>We define the full name and desired default color for display purposes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.fullName&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;Gene ontology table&quot;</span>)

<span class="kw">setMethod</span>(<span class="st">&quot;.panelColor&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;#BB00FF&quot;</span>)</code></pre></div>
<p>We add our UI element for showing the gene set table, which is simply a <code>DataTable</code> object from the <em><a href="https://CRAN.R-project.org/package=DT">DT</a></em> package. Note that <em><a href="https://CRAN.R-project.org/package=shiny">shiny</a></em> also has a <code>dataTableOutput</code> function so care must be taken to disambiguate them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.defineOutput&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, ...) {
    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)
    <span class="kw">tagList</span>(DT<span class="op">::</span><span class="kw">dataTableOutput</span>(panel_name))
})</code></pre></div>
<p>We set up interface elements for changing the annotation parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.defineDataInterface&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, se, select_info) {
    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)
    <span class="kw">list</span>(
        <span class="kw">selectInput</span>(<span class="kw">paste0</span>(panel_name, <span class="st">&quot;_IDType&quot;</span>),
            <span class="dt">label=</span><span class="st">&quot;ID type:&quot;</span>,
            <span class="dt">choices=</span>allowable,
            <span class="dt">selected=</span>x[[<span class="st">&quot;IDType&quot;</span>]]
        ),
        <span class="kw">selectInput</span>(<span class="kw">paste0</span>(panel_name, <span class="st">&quot;_Organism&quot;</span>),
            <span class="dt">label=</span><span class="st">&quot;Organism&quot;</span>,
            <span class="dt">choices=</span><span class="kw">c</span>(<span class="st">&quot;org.Hs.eg.db&quot;</span>, <span class="st">&quot;org.Mm.eg.db&quot;</span>),
            <span class="dt">selected=</span>x[[<span class="st">&quot;Organism&quot;</span>]]
        )
    )
})</code></pre></div>
<p>Our implementation will be a pure transmitter, i.e., it will not respond to row or column selections from other panels. To avoid confusion, we can hide all selection parameter UI elements by specializing the <code>.hideInterface()</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.hideInterface&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, field) {
    <span class="cf">if</span> (field <span class="op">%in%</span><span class="st"> &quot;SelectionBoxOpen&quot;</span>) {
        <span class="ot">TRUE</span>
    } <span class="cf">else</span> {
        <span class="kw">callNextMethod</span>()
    }
})</code></pre></div>
</div>
<div id="generating-the-output" class="section level2">
<h2><span class="header-section-number">8.4</span> Generating the output</h2>
<p>We actually generate the output by specializing the <code>.generateOutput()</code> function, using the <em><a href="https://bioconductor.org/packages/3.11/GO.db">GO.db</a></em> package to create a table of GO terms and their definitions. We also store the number of available genes in the <code>contents</code> - this will be used later to compute the percentage of all genes in a given gene set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.generateOutput&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, se, ..., all_memory, all_contents) {
    envir &lt;-<span class="st"> </span><span class="kw">new.env</span>()
    commands &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;require(GO.db);&quot;</span>,
        <span class="st">&quot;tab &lt;- select(GO.db, keys=keys(GO.db), columns=&#39;TERM&#39;);&quot;</span>,
        <span class="st">&quot;rownames(tab) &lt;- tab$GOID;&quot;</span>,
        <span class="st">&quot;tab$GOID &lt;- NULL;&quot;</span>)
    <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text=</span>commands), <span class="dt">envir=</span>envir)
    <span class="kw">list</span>(
        <span class="dt">commands=</span><span class="kw">list</span>(commands), 
        <span class="dt">contents=</span><span class="kw">list</span>(<span class="dt">table=</span>envir<span class="op">$</span>tab, <span class="dt">available=</span><span class="kw">nrow</span>(se))
    )
})</code></pre></div>
<p>We don’t actually depend on any parameters of <code>x</code> itself to generate this table. However, one could imagine a more complex case where the <code>GOTable</code> itself responds to a multiple row selection, e.g., by subsetting to the gene sets that contain genes in the selected row.</p>
</div>
<div id="creating-the-observers-3" class="section level2">
<h2><span class="header-section-number">8.5</span> Creating the observers</h2>
<p>We specialize <code>.createObservers</code> to define some observers to respond to changes in our new interface elements. This also involves creating an observer to respond to a change in the selection of a <code>DataTable</code> row, calling <code>.requestActiveSelectionUpdate()</code> to trigger changes in panels that are receiving the multiple row selection. (We set up observers for the search fields as well, as a courtesy to restore them properly upon re-rendering.) Note the use of <code>callNextMethod()</code> to ensure that observers of the parent class are also created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.createObservers&quot;</span>, <span class="st">&quot;GOTable&quot;</span>,
    <span class="cf">function</span>(x, se, input, session, pObjects, rObjects)
{
    <span class="kw">callNextMethod</span>()

    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)

    <span class="kw">.createUnprotectedParameterObservers</span>(panel_name,
        <span class="dt">fields=</span><span class="kw">c</span>(<span class="st">&quot;Organism&quot;</span>, <span class="st">&quot;IDType&quot;</span>), 
        <span class="dt">input=</span>input, <span class="dt">pObjects=</span>pObjects, <span class="dt">rObjects=</span>rObjects)

    <span class="co"># Observer for the DataTable row selection:</span>
    select_field &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_rows_selected&quot;</span>)
    multi_name &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_&quot;</span>, iSEE<span class="op">:::</span>.flagMultiSelect)
    <span class="kw">observeEvent</span>(input[[select_field]], {
        chosen &lt;-<span class="st"> </span>input[[select_field]]
        <span class="cf">if</span> (<span class="kw">length</span>(chosen)<span class="op">==</span>0L) {
            chosen &lt;-<span class="st"> &quot;&quot;</span> 
        } <span class="cf">else</span> {
            chosen &lt;-<span class="st"> </span><span class="kw">rownames</span>(pObjects<span class="op">$</span>contents[[panel_name]]<span class="op">$</span>table)[chosen]
        }

        previous &lt;-<span class="st"> </span>pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Selected&quot;</span>]]
        <span class="cf">if</span> (chosen<span class="op">==</span>previous) {
            <span class="kw">return</span>(<span class="ot">NULL</span>)
        }
        pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Selected&quot;</span>]] &lt;-<span class="st"> </span>chosen
        <span class="kw">.requestActiveSelectionUpdate</span>(panel_name, rObjects, <span class="dt">update_output=</span><span class="ot">FALSE</span>)
    }, <span class="dt">ignoreNULL=</span><span class="ot">FALSE</span>)

    <span class="co"># Observer for the search field:</span>
    search_field &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_search&quot;</span>)
    <span class="kw">observeEvent</span>(input[[search_field]], {
        search &lt;-<span class="st"> </span>input[[search_field]]
        <span class="cf">if</span> (<span class="kw">identical</span>(search, pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Search&quot;</span>]])) {
            <span class="kw">return</span>(<span class="ot">NULL</span>)
        }
        pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;Search&quot;</span>]] &lt;-<span class="st"> </span>search
    })

    <span class="co"># Observer for the column search fields:</span>
    colsearch_field &lt;-<span class="st"> </span><span class="kw">paste0</span>(panel_name, <span class="st">&quot;_search_columns&quot;</span>)
    <span class="kw">observeEvent</span>(input[[colsearch_field]], {
        search &lt;-<span class="st"> </span>input[[colsearch_field]]
        <span class="cf">if</span> (<span class="kw">identical</span>(search, pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;SearchColumns&quot;</span>]])) {
            <span class="kw">return</span>(<span class="ot">NULL</span>)
        }
        pObjects<span class="op">$</span>memory[[panel_name]][[<span class="st">&quot;SearchColumns&quot;</span>]] &lt;-<span class="st"> </span>search
    })
})</code></pre></div>
<p>We set up a rendering expression for the output table by specializing <code>.renderOutput()</code>. This uses the <code>renderDataTable()</code> function from the <em><a href="https://CRAN.R-project.org/package=DT">DT</a></em> package (again, this has a similar-but-not-identical function in <em><a href="https://CRAN.R-project.org/package=shiny">shiny</a></em>, so be careful which one you import.) Some effort is involved in making sure that the output table responds to the memorized parameter values of our <code>GOTable</code> panel.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.renderOutput&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, se, ..., output, pObjects, rObjects) {
    <span class="kw">callNextMethod</span>()

    panel_name &lt;-<span class="st"> </span><span class="kw">.getEncodedName</span>(x)
    output[[panel_name]] &lt;-<span class="st"> </span>DT<span class="op">::</span><span class="kw">renderDataTable</span>({
        <span class="kw">.trackUpdate</span>(panel_name, rObjects)
        param_choices &lt;-<span class="st"> </span>pObjects<span class="op">$</span>memory[[panel_name]]

        t.out &lt;-<span class="st"> </span><span class="kw">.retrieveOutput</span>(panel_name, se, pObjects, rObjects)
        full_tab &lt;-<span class="st"> </span>t.out<span class="op">$</span>contents<span class="op">$</span>table
        pObjects<span class="op">$</span>varname[[panel_name]] &lt;-<span class="st"> &quot;tab&quot;</span>

        chosen &lt;-<span class="st"> </span>param_choices[[<span class="st">&quot;Selected&quot;</span>]]
        search &lt;-<span class="st"> </span>param_choices[[<span class="st">&quot;Search&quot;</span>]]
        search_col &lt;-<span class="st"> </span>param_choices[[<span class="st">&quot;SearchColumns&quot;</span>]]
        search_col &lt;-<span class="st"> </span><span class="kw">lapply</span>(search_col, <span class="dt">FUN=</span><span class="cf">function</span>(x) { <span class="kw">list</span>(<span class="dt">search=</span>x) })

        <span class="co"># If the existing row in memory doesn&#39;t exist in the current table, we</span>
        <span class="co"># don&#39;t initialize it with any selection.</span>
        idx &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">rownames</span>(full_tab)<span class="op">==</span>chosen)[<span class="dv">1</span>]
        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.na</span>(idx)) {
            selection &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">mode=</span><span class="st">&quot;single&quot;</span>, <span class="dt">selected=</span>idx)
        } <span class="cf">else</span> {
            selection &lt;-<span class="st"> &quot;single&quot;</span>
        }

        DT<span class="op">::</span><span class="kw">datatable</span>(
            full_tab, <span class="dt">filter=</span><span class="st">&quot;top&quot;</span>, <span class="dt">rownames=</span><span class="ot">TRUE</span>,
            <span class="dt">options=</span><span class="kw">list</span>(
                <span class="dt">search=</span><span class="kw">list</span>(<span class="dt">search=</span>search, <span class="dt">smart=</span><span class="ot">FALSE</span>, <span class="dt">regex=</span><span class="ot">TRUE</span>, <span class="dt">caseInsensitive=</span><span class="ot">FALSE</span>),
                <span class="dt">searchCols=</span><span class="kw">c</span>(<span class="kw">list</span>(<span class="ot">NULL</span>), search_col), <span class="co"># row names are the first column!</span>
                <span class="dt">scrollX=</span><span class="ot">TRUE</span>),
            <span class="dt">selection=</span>selection
        )
    })
})</code></pre></div>
</div>
<div id="handling-selections" class="section level2">
<h2><span class="header-section-number">8.6</span> Handling selections</h2>
<p>Now for the most important bit - configuring the <code>GOTable</code> to transmit a multiple row selection to other panels. This is achieved by specializing a series of <code>.multiSelection*()</code> methods. The first is the <code>.multiSelectionDimension()</code>, which controls the dimension being transmitted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionDimension&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) <span class="st">&quot;row&quot;</span>)</code></pre></div>
<p>The next most important method is the <code>.multiSelectionCommands()</code>, which tells <code>iSEE()</code> how to create the multiple row selection from the selected <code>DataTable</code> row. It is expected to return a vector of commands that, when evaluated, creates a character vector of row names for transmission. This has an option (<code>index</code>) to differentiate between active and saved selections, though the latter case is not relevant to our <code>GOTable</code> so we will simply ignore it. We also need to protect against cases where the requested GO term is not found, upon which we simply return an empty character vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionCommands&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, index) {
    orgdb &lt;-<span class="st"> </span>x[[<span class="st">&quot;Organism&quot;</span>]]
    type &lt;-<span class="st"> </span>x[[<span class="st">&quot;IDType&quot;</span>]]
    <span class="kw">c</span>(
        <span class="kw">sprintf</span>(<span class="st">&quot;require(%s);&quot;</span>, orgdb),
        <span class="kw">sprintf</span>(<span class="st">&quot;selected &lt;- tryCatch(select(%s, keys=%s, keytype=&#39;GO&#39;, </span>
<span class="st">    column=%s)$SYMBOL, error=function(e) character(0));&quot;</span>, 
            orgdb, <span class="kw">deparse</span>(x[[<span class="st">&quot;Selected&quot;</span>]]), <span class="kw">deparse</span>(type)),
        <span class="st">&quot;selected &lt;- intersect(selected, rownames(se));&quot;</span>
    )
})</code></pre></div>
<p>We also define some generics to indicate whether a <code>DataTable</code> row is currently selected, and how to delete that selection. For the latter, we replace the selected row with an empty string to indicate that no selection has been made, consistent with the actions of our observer in <code>.createObservers()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionActive&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) {
    <span class="cf">if</span> (x[[<span class="st">&quot;Selected&quot;</span>]]<span class="op">!=</span><span class="st">&quot;&quot;</span>) {
        x[[<span class="st">&quot;Selected&quot;</span>]]
    } <span class="cf">else</span> {
        <span class="ot">NULL</span>
    }
})

<span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionClear&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x) {
    x[[<span class="st">&quot;Selected&quot;</span>]] &lt;-<span class="st"> &quot;&quot;</span>
    x
})</code></pre></div>
<p>Finally, we define a method to determine the total number of available genes. The default is to use the number of rows of the <code>data.frame</code> used in the <code>datatable()</code> call, but that would not be right for us as it represents the number of gene sets. Instead, we use the availability information that we previously stored in the <code>contents</code> during <code>.generateOutput()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setMethod</span>(<span class="st">&quot;.multiSelectionAvailable&quot;</span>, <span class="st">&quot;GOTable&quot;</span>, <span class="cf">function</span>(x, contents) {
    contents<span class="op">$</span>available
})</code></pre></div>
</div>
<div id="in-action-3" class="section level2">
<h2><span class="header-section-number">8.7</span> In action</h2>
<p>Let’s put our new panel to the test using the <code>sce</code> object, preprocessed in a <a href="developing.html#developing">previous chapter</a>.</p>
<p>Setting up the iSEE instance is as easy as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">got &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;GOTable&quot;</span>, <span class="dt">PanelWidth=</span>8L)
rst &lt;-<span class="st"> </span><span class="kw">RowDataTable</span>(<span class="dt">RowSelectionSource=</span><span class="st">&quot;GOTable1&quot;</span>)
app &lt;-<span class="st"> </span><span class="kw">iSEE</span>(sce, <span class="dt">initial=</span><span class="kw">list</span>(got, rst))</code></pre></div>
<p>Clicking on any row in the <code>GOTable</code> will subset <code>RowTable1</code> to only those genes in the corresponding GO term.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="annotated-gene-list.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["iSEE-book.pdf", "iSEE-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
